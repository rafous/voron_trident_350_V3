[include mainsail.cfg]
[mcu CB1]
serial: /tmp/klipper_host_mcu


#[include MACROS/filament_dryer.cfg]
[include PARTS/*.cfg]
#[include MACROS/divers.cfg]
#[include MACROS/fan.cfg]
#[include MACROS/KNOMI.cfg]
#[include MACROS/start.cfg]
#[include MACROS/OrbiterSensor-2.cfg]
#[include MACROS/end.cfg]
#[include MACROS/clean_nozzle.cfg]
#[include mesh.cfg]
#[include MACROS/test.cfg]
#[include MACROS/client.cfg]
#[include shell_command.cfg]
#[include motor_database.cfg]

#[include led_progress.cfg]
#[include auto_tune.cfg]
#[include K-ShakeTune/*.cfg]
[include KAMP_Settings.cfg]
[include MACROS/*.cfg]

##	[X in MOTOR1] - B Motor
##	[Y in MOTOR2] - A Motor
##	[E in MOTOR8] - Extruder
##	Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
##--------------------------------------------------------------------


#####################################################################
# 	X/Y Stepper Settings
#####################################################################

## X Stepper on Motor1(B Motor)
[stepper_x]
step_pin: PE2
dir_pin: !PB4
enable_pin: !PC11
microsteps: 32
rotation_distance: 40
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2240_stepper_x:virtual_endstop
position_endstop: 350
position_min: -1
position_max: 354
homing_speed: 25   #Max 100
homing_retract_dist: 0
homing_positive_dir: true

[tmc2240 stepper_x]
cs_pin: PC10
#spi_bus: spi1
run_current: 1.500
stealthchop_threshold: 0
spi_software_sclk_pin: PA5
spi_software_mosi_pin: PA7
spi_software_miso_pin: PA6
diag0_pin: !PF3 # Broche connectée à TMC DIAG1  (ou utilisez diag0_pin / DIAG0 pin)
driver_SGT: 1   # -64 est la valeur la plus sensible, 63 est moins sensible
interpolate : true

## Y Stepper on Motor2 (A Motor)
[stepper_y]
step_pin: PF12
dir_pin: !PF11
enable_pin: !PB3
microsteps: 32
rotation_distance: 40
endstop_pin: tmc2240_stepper_y:virtual_endstop
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
position_endstop: 361
position_min: -1
position_max: 361
homing_speed: 25  #Max 100
homing_retract_dist: 0
homing_positive_dir: true

[tmc2240 stepper_y]
cs_pin: PF13
#spi_bus: spi1
run_current: 1.500
stealthchop_threshold: 0
spi_software_sclk_pin: PA5
spi_software_mosi_pin: PA7
spi_software_miso_pin: PA6
diag0_pin: !PF4 # Broche connectée à TMC DIAG1  (ou utilisez diag0_pin / DIAG0 pin)
driver_SGT: 2 #x0  # -64 est la valeur la plus sensible, 63 est moins sensible
interpolate : true

#####################################################################
# 	Z Stepper Settings
#####################################################################

##	Z1 Stepper - Rear Left on Motor5
[stepper_z]
step_pin: PC9
dir_pin: PC8
enable_pin: !PD1
endstop_pin: probe:z_virtual_endstop
rotation_distance: 4
microsteps: 16
position_min: -5
position_max: 250
homing_speed: 8
second_homing_speed: 3
homing_retract_dist: 3

[tmc2209 stepper_z]
uart_pin: PD0
interpolate: true
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z2 Stepper - Rear Right on Motor6
[stepper_z1]
step_pin: PA10
dir_pin: PA14
enable_pin: !PA15
rotation_distance: 4
microsteps: 16

[tmc2209 stepper_z1]
uart_pin: PF8
interpolate: true
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z3 Stepper - Front Right on Motor7
[stepper_z2]
step_pin: PD11
dir_pin: PD9
enable_pin: !PD15
rotation_distance: 4
microsteps: 16

##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z2]
uart_pin: PD14
interpolate: true
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
# 	Extruder
#####################################################################

#	E0 on Motor8
#[extruder]
#step_pin: PD10
#dir_pin: PD8
#enable_pin: !PD9
##  Update value below when you perform extruder calibration
##  If you ask for 100mm of filament, but in reality it is 98mm:
##  rotation_distance = <previous_rotation_distance> * <actual_extrude_distance> / 100
##  22.6789511 is a good starting point
#rotation_distance: 22.6789511   #Bondtech 5mm Drive Gears
##  Update Gear Ratio depending on your Extruder Type
##  Use 50:10 for Stealthburner/Clockwork 2
##  Use 50:17 for Afterburner/Clockwork (BMG Gear Ratio)
##  Use 80:20 for M4, M3.1
#gear_ratio: 50:10
#microsteps: 16
#full_steps_per_rotation: 200	#200 for 1.8 degree, 400 for 0.9 degree
#nozzle_diameter: 0.400
#filament_diameter: 1.75
#heater_pin: PE3
#sensor_pin: PA1
#min_temp: 10
#max_temp: 270
#max_power: 1.0
#min_extrude_temp: 170
#control = pid
#pid_kp = 26.213
#pid_ki = 1.304
#pid_kd = 131.721
##	Try to keep pressure_advance below 1.0
#pressure_advance: 0.05
##	Default is 0.040, leave stock
#pressure_advance_smooth_time: 0.040

##	E0 on Motor7
##	Make sure to update below for your relevant driver (2208 or 2209)
#[tmc2209 extruder]
#uart_pin: PC7
#interpolate: false
#run_current: 0.5
#sense_resistor: 0.110
#stealthchop_threshold: 0

#[filament_switch_sensor material_0]
#switch_pin: PC1

#[filament_switch_sensor material_1]
#switch_pin: PC2

#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - HE1
heater_pin: PB7 
## Check what thermistor type you have. See https://www.klipper3d.org/Config_Reference.html#common-thermistors for common thermistor types.
## Use "Generic 3950" for NTC 100k 3950 thermistors
sensor_type: Generic 3950
sensor_pin: PA0
##  Adjust max_power so it doesn't exceed the SSR rating. The Omron G3NA-210B-DC5 SSR is rated at 4 amps without a heatsink.
##  The formula is "4 / (Wattage_of_bed_heater / Mains_voltage) = max_power"
##  If max_power is greater than 1.0, use 1.0
max_power: 0.6
min_temp: 0
max_temp: 120
control: pid
pid_kp: 58.437
pid_ki: 2.347
pid_kd: 363.769



##--------------------------------------------------------------------

[printer]
kinematics: corexy
max_velocity: 600  
max_accel: 6000    			#Max 4000
max_z_velocity: 15 			#Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_42003D000F504B4633373520-if00

#[mcu]
#canbus_uuid: a6348a01419e
#canbus_interface: can0

[temperature_sensor MCU]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100







#####################################################################
# 	Fan Control
#####################################################################

#[fan]
##	Print Cooling Fan - CNC_FAN0
#pin: PE6
#kick_start_time: 0.5
##	Depending on your fan, you may need to increase this value
##	if your fan will not start. Can change cycle_time (increase)
##	if your fan is not able to slow down effectively
#off_below: 0.10

#[heater_fan hotend_fan]
##	Hotend Fan - CNC_FAN1
#pin: PE0
#max_power: 1.0
#kick_start_time: 0.5
#heater: extruder
#heater_temp: 50.0
##	If you are experiencing back flow, you can reduce fan_speed
#fan_speed: 1.0

#[heater_fan controller_fan]
##	Controller fan - CNC_FAN2
##pin: PC12
#kick_start_time: 0.5
#heater: heater_bed
#heater_temp: 45.0

#[heater_fan exhaust_fan]
##	Exhaust fan - CNC_FAN3
#pin: PE5
#max_power: 1.0
#shutdown_speed: 0.0
#kick_start_time: 5.0
#heater: heater_bed
#heater_temp: 60
#fan_speed: 1.0

#[heater_fan fan4]
#pin: PE4
#tachometer_pin: PC13

#[heater_fan fan5]
#pin: PB8
#tachometer_pin: PC14

#[heater_fan fan6]
#pin: PB9
#tachometer_pin: PC15

#####################################################################
# 	LED Control
#####################################################################

#[output_pin caselight]
# Chamber Lighting - HE2 Connector (Optional)
#pin: PB6
#pwm:true
#shutdown_value: 0
#value:1
#cycle_time: 0.01





[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE9, EXP1_2=PE10,
    EXP1_3=PE11, EXP1_4=PE12,
    EXP1_5=PE13, EXP1_6=PE14,    # Slot in the socket on this side
    EXP1_7=PE15, EXP1_8=PB10,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PB14, EXP2_2=PB13,
    EXP2_3=PF7, EXP2_4=PB12,
    EXP2_5=PE7, EXP2_6=PB11,      # Slot in the socket on this side
    EXP2_7=PE8, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PC5

# See the sample-lcd.cfg file for definitions of common LCD displays.



[include shell_command.cfg]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [beacon model default]
#*# model_coef = 1.0208775148422078,
#*# 	  0.7691831662689582,
#*# 	  0.12909051710183164,
#*# 	  -0.14870489015411933,
#*# 	  0.1656480324730331,
#*# 	  0.8109828306967143,
#*# 	  -0.2891325927550946,
#*# 	  -1.2663117161462039,
#*# 	  0.17282413972293414,
#*# 	  0.6366547618071212
#*# model_domain = 3.13830699706653e-07,3.2517634148949316e-07
#*# model_range = 0.400000,2.000000
#*# model_temp = 16.750969
#*# model_offset = 0.26000
#*#
#*# [input_shaper]
#*# shaper_type_x = 2hump_ei
#*# shaper_freq_x = 90.6
#*# shaper_type_y = ei
#*# shaper_freq_y = 62.2
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.017533, -0.015841, -0.010774, -0.003429, 0.007330, 0.011264
#*# 	  -0.010482, -0.007147, -0.005056, 0.002871, 0.012151, 0.016968
#*# 	  -0.002345, -0.003689, 0.000078, 0.007577, 0.016832, 0.021834
#*# 	  0.001624, 0.003647, 0.007323, 0.016883, 0.026076, 0.029579
#*# 	  0.009670, 0.010659, 0.012937, 0.021235, 0.031568, 0.035948
#*# 	  0.016049, 0.016872, 0.018935, 0.027550, 0.033502, 0.040020
#*# x_count = 6
#*# y_count = 6
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 160.0
#*# max_x = 190.0
#*# min_y = 160.0
#*# max_y = 190.0
